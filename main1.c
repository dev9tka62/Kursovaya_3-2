
#include "main.h"

int s = 0;   // ??? ??? ???? ???????
int zvuk = 0;  // ??? ???????????? ?????? ??????? ??? ????
int zvukperekl = 0;  // ??? ??????? ??????????????
int ventil = 0; // ??? ?????(???? ?????????? ??????? ???????) ??? ?????? ????
int restart = 0;


	else if(s == 1 || s == 2){ // ???? ??????? ??? ???????? ??? ? ?????? ?????? ??????????????, ??? ??????? ????? ???? ??????? ? ?????????? ??????
		s = 0;
		zvuk = 0;
		ventil = 0;
		PORTB &= ~(1<<PB7);
		PORTB &= ~(1<<PB6);
		clearlcd();
		setpos(0,0);
		str_lcd("OFF");
	}
}
ISR(TIMER1_COMPA_vect){ // ??????, ???????? ?? 1 ???????, ??? ??????? ?????????
	if(zvuk == 1){  // ??????? ( ???? ???????? ????? ??????)
		if(zvukperekl==0){ // ???????, ???? ???? ????????, ?????? ????????
			zvukperekl = 1;
			PORTB |= (1<<PB7);
		}
		else if(zvukperekl==1) { // ???????, ???? ???? ???????, ?????????
			PORTB &= ~(1<<PB7);
			zvukperekl = 0;
		}
	}
}
//----------------------------------------
//???? ?????? ?????-??????
void port_ini(void)
{
	PORTD=0x00;  // ???? ??? ??????
	DDRD=0xFF;
	
	DDRA = 0x00;  // ????? ??? ????????
	PORTA = 0xFF;
	
	DDRB |= (1<<7);  // ???? ??? ????????? ?????
	PORTB &= ~(1<<7);
	DDRB |= (1<<6);  // ???? ??? ???????
	PORTB &= ~(1<<6);
	
	DDRC = 0x00; // ???? ??? ???????? ????????
	PORTC = 0xFF;
}
void initinterupt(){ // ????????? ?????????? INT2
	DDRB &= ~(1<<2);
	PORTB |= (1<<2);
	GICR |= (1<<INT2);
	MCUCR = (0<<ISC2);
	sei();
}
void initTimer(){  // timer 1
	TIMSK |= (1<<OCIE1A);
	TCCR1B |= (1<<WGM12);
	TCCR1B |= (1<<CS12) | (1<<CS10);  //presc 1024
	OCR1AH = 0b00011110;  //   8000000/ 1 ??? /1024=7812
	OCR1AL = 0b10000100;
}

//----------------------------------------
//????? ???????

void gaz () {
	if ((PINA&(1<<PA5))==0) {
		zvuk = 1;
		ventil = 1;
		clearlcd();
		setpos(3,0);
		str_lcd("YTE4KA");
		setpos(5,1);
		str_lcd("GAZA");
		_delay_ms(400);
	}
}

void sostoyaniesystemy(){  // ??????? ??? ???????? ?????? ????????? ????????, ???? ??? ? ?????, ??????? ????, ??? ??????? ???/????
	if(PINA == 0xFF && PINC == 0xFF){
		if(s == 0){ // ??? ?????????? ??????? ?????????? ??????, ???? ??????? ? ?????
			zvuk = 0;
			ventil = 0;
			PORTB &= ~(1<<PB7); 
		}
		clearlcd();
		setpos(0,0);
		if(s == 1){
			str_lcd("ON");
		}
		else{
			str_lcd("OFF");
		}
	}
	_delay_ms(400);
}
